<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DVLA Fitness to Drive | WMEBEM Clinical Tool</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #0056b3; /* NHS/Medical Blue */
            --primary-dark: #003d80;
            --secondary: #64748b;
            --bg-body: #f1f5f9;
            --bg-card: #ffffff;
            --text-main: #1e293b;
            --text-muted: #64748b;
            --border: #e2e8f0;
            --accent-neuro: #0ea5e9;
            --accent-cardio: #ef4444;
            --accent-endocrine: #10b981;
            --accent-psych: #8b5cf6;
            --accent-drugs: #f59e0b;
            --radius: 8px;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }

        * { box-sizing: border-box; }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-body);
            color: var(--text-main);
            margin: 0;
            padding: 0;
            line-height: 1.5;
            display: flex;
            min-height: 100vh;
        }

        /* --- Sidebar Navigation --- */
        .sidebar {
            width: 250px;
            background: var(--bg-card);
            border-right: 1px solid var(--border);
            position: fixed;
            height: 100vh;
            overflow-y: auto;
            padding: 20px;
            display: flex;
            flex-direction: column;
            z-index: 100;
        }

        .logo-area {
            text-align: center;
            margin-bottom: 30px;
        }

        .logo-area img {
            max-width: 120px;
            height: auto;
        }

        .nav-links a {
            display: block;
            padding: 10px 15px;
            color: var(--text-muted);
            text-decoration: none;
            border-radius: var(--radius);
            margin-bottom: 5px;
            font-size: 0.9em;
            font-weight: 500;
            transition: all 0.2s;
        }

        .nav-links a:hover, .nav-links a.active {
            background-color: #f0f9ff;
            color: var(--primary);
        }

        .nav-category {
            font-size: 0.75em;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: #94a3b8;
            margin: 20px 0 10px 15px;
            font-weight: 700;
        }

        /* --- Main Content --- */
        .main-content {
            flex: 1;
            margin-left: 250px;
            padding: 30px 40px;
            max-width: 1200px;
        }

        /* --- Header & Search --- */
        header {
            margin-bottom: 40px;
        }

        h1 {
            font-size: 1.8rem;
            color: var(--text-main);
            margin: 0 0 10px 0;
        }

        h2 {
            font-size: 1rem;
            font-weight: 400;
            color: var(--secondary);
            margin: 0;
        }

        .search-bar {
            margin-top: 20px;
            position: relative;
        }

        .search-bar input {
            width: 100%;
            padding: 15px 20px;
            padding-left: 45px;
            border: 1px solid var(--border);
            border-radius: 50px;
            font-size: 1rem;
            box-shadow: var(--shadow);
            outline: none;
            transition: border-color 0.2s;
        }

        .search-bar input:focus {
            border-color: var(--primary);
        }

        .search-icon {
            position: absolute;
            left: 18px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--secondary);
        }

        /* --- Alerts --- */
        .alert-box {
            background-color: #fff7ed;
            border-left: 4px solid #f97316;
            padding: 15px;
            border-radius: var(--radius);
            margin-bottom: 30px;
            color: #9a3412;
            font-size: 0.95em;
        }

        /* --- Sections & Cards --- */
        .section-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-top: 40px;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--border);
        }
        
        .section-header h3 {
            margin: 0;
            color: var(--primary-dark);
            font-size: 1.25rem;
        }

        .guidance-link {
            font-size: 0.85rem;
            color: var(--primary);
            text-decoration: none;
            font-weight: 500;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 20px;
            transition: transform 0.2s, box-shadow 0.2s;
            border-top: 4px solid var(--secondary); /* Default top border */
            display: flex;
            flex-direction: column;
        }

        .card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }

        /* Category Colors */
        .cat-neuro .card { border-top-color: var(--accent-neuro); }
        .cat-cardio .card { border-top-color: var(--accent-cardio); }
        .cat-endocrine .card { border-top-color: var(--accent-endocrine); }
        .cat-psych .card { border-top-color: var(--accent-psych); }
        .cat-drugs .card { border-top-color: var(--accent-drugs); }

        .card h4 {
            margin: 0 0 5px 0;
            font-size: 1.1rem;
            color: var(--text-main);
            font-weight: 600;
        }

        .card h5 {
            margin: 0 0 15px 0;
            font-size: 0.85rem;
            color: var(--text-muted);
            font-weight: 500;
        }

        .card-body {
            font-size: 0.9rem;
            color: #334155;
            flex-grow: 1;
        }
        
        .card-body p { margin-bottom: 10px; }
        .card-body ul { padding-left: 20px; margin-top: 5px; }
        .card-body li { margin-bottom: 4px; }

        /* --- Action Buttons --- */
        .btn-generate {
            margin-top: 15px;
            background-color: #f1f5f9;
            color: var(--primary);
            border: 1px solid transparent;
            padding: 10px;
            border-radius: var(--radius);
            width: 100%;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.9rem;
            text-align: center;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn-generate:hover {
            background-color: #e0f2fe;
            color: var(--primary-dark);
        }

        /* --- Modal (Letter Generator) --- */
        .modal-overlay {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.5);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal {
            background: white;
            width: 90%;
            max-width: 700px;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
            max-height: 90vh;
            display: flex;
            flex-direction: column;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--border);
            padding-bottom: 15px;
            margin-bottom: 20px;
        }

        .modal-header h3 { margin: 0; color: var(--primary); }
        .close-modal { background: none; border: none; font-size: 1.5rem; cursor: pointer; color: #64748b; }

        .letter-preview {
            background: #f8fafc;
            border: 1px solid var(--border);
            padding: 20px;
            font-family: 'Courier New', Courier, monospace;
            font-size: 0.9rem;
            white-space: pre-wrap;
            overflow-y: auto;
            border-radius: 4px;
            flex-grow: 1;
            margin-bottom: 20px;
        }

        .modal-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }

        .btn {
            padding: 10px 20px;
            border-radius: 6px;
            font-weight: 500;
            cursor: pointer;
            border: none;
            transition: 0.2s;
        }

        .btn-primary { background: var(--primary); color: white; }
        .btn-primary:hover { background: var(--primary-dark); }
        .btn-secondary { background: #e2e8f0; color: var(--text-main); }
        .btn-secondary:hover { background: #cbd5e1; }

        /* --- Footer --- */
        footer {
            margin-top: 60px;
            padding-top: 20px;
            border-top: 1px solid var(--border);
            color: var(--text-muted);
            font-size: 0.8rem;
            text-align: center;
        }

        /* --- Responsive --- */
        @media (max-width: 768px) {
            .sidebar { display: none; }
            .main-content { margin-left: 0; padding: 20px; }
            .grid { grid-template-columns: 1fr; }
        }
        
        @media print {
            .sidebar, .search-bar, .btn-generate, .modal-overlay, .guidance-link { display: none; }
            .main-content { margin: 0; padding: 0; }
            .card { break-inside: avoid; border: 1px solid #000; box-shadow: none; }
            body { font-size: 12pt; background: white; }
        }
    </style>
</head>
<body>

    <nav class="sidebar">
        <div class="logo-area">
            <img src="https://iili.io/KGQOvkl.md.png" alt="WMEBEM Logo">
        </div>
        <div class="nav-links">
            <a href="#" onclick="scrollToSection('top')" class="active">Dashboard Home</a>
            
            <div class="nav-category">Quick Reference</div>
            <a href="#" onclick="scrollToSection('responsibilities')">Legal Duties</a>
            <a href="#" onclick="scrollToSection('updates')">2025 Updates</a>
            
            <div class="nav-category">Conditions</div>
            <a href="#" onclick="scrollToSection('neurological')">Neurological</a>
            <a href="#" onclick="scrollToSection('cardiovascular')">Cardiovascular</a>
            <a href="#" onclick="scrollToSection('diabetes')">Diabetes / Endo</a>
            <a href="#" onclick="scrollToSection('psychiatric')">Psychiatric</a>
            <a href="#" onclick="scrollToSection('drugs')">Drugs & Alcohol</a>
        </div>
    </nav>

    <main class="main-content" id="top">
        <header>
            <h1>DVLA Fitness to Drive Guide</h1>
            <h2>September 2025 Standards | For UK Emergency Medicine Doctors</h2>
            
            <div class="search-bar">
                <span class="search-icon">üîç</span>
                <input type="text" id="searchInput" placeholder="Search condition (e.g., Seizure, Syncope, Stroke)..." onkeyup="filterContent()">
            </div>
        </header>

        <div class="alert-box">
            <strong>üö® LEGAL DUTY:</strong> Patients must notify the DVLA of relevant conditions. Your duty is to advise them of this and document it. You only breach confidentiality to notify DVLA directly if the patient cannot/will not, and public safety is at risk.
        </div>

        <section id="responsibilities" class="cat-general">
            <div class="section-header">
                <h3>‚öñÔ∏è Professional Responsibilities</h3>
            </div>
            <div class="grid">
                <div class="card">
                    <h4>Confidentiality</h4>
                    <h5>GMC Guidance</h5>
                    <div class="card-body">
                        <p>Advise patients of their legal duty to inform DVLA. Document this advice.</p>
                        <p><strong>Notify DVLA directly if:</strong></p>
                        <ul>
                            <li>Patient has a condition affecting safe driving.</li>
                            <li>Patient cannot or will not notify DVLA.</li>
                            <li>Risk of death or serious harm to public.</li>
                        </ul>
                    </div>
                </div>
                <div class="card">
                    <h4>Sudden Disabling Events</h4>
                    <h5>Risk Thresholds</h5>
                    <div class="card-body">
                        <p><strong>Do not drive</strong> if risk of sudden disabling event is:</p>
                        <ul>
                            <li>>20% per annum (Group 1 - Car)</li>
                            <li>>2% per annum (Group 2 - HGV/Bus)</li>
                        </ul>
                    </div>
                </div>
            </div>
        </section>

        <section id="updates" class="cat-updates">
            <div class="section-header">
                <h3>‚úÖ Sept 2025 Key Updates</h3>
            </div>
            <div class="grid">
                <div class="card">
                    <h4>Neuro & Cardio Changes</h4>
                    <div class="card-body">
                        <ul>
                            <li><strong>TLoC:</strong> New consolidated Appendix D.</li>
                            <li><strong>ACS:</strong> Explicitly includes MINOCA and Type 2 MI.</li>
                            <li><strong>Diabetes (G2):</strong> Insulin-treated G2 drivers now need 6 weeks of glucose readings (previously different).</li>
                        </ul>
                    </div>
                </div>
            </div>
        </section>

        <section id="neurological" class="cat-neuro">
            <div class="section-header">
                <h3>üß† Neurological</h3>
                <a href="https://www.gov.uk/guidance/neurological-disorders-assessing-fitness-to-drive" target="_blank" class="guidance-link">View Full Guidance ‚Üó</a>
            </div>
            <div class="grid">
                <div class="card" data-condition="tloc">
                    <h4>Transient Loss of Consciousness</h4>
                    <h5>Unexplained, Reflex, Cough Syncope</h5>
                    <div class="card-body">
                        <p><strong>Unexplained TLoC:</strong> Stop driving. G1: 6 months off. G2: 12 months off.</p>
                        <p><strong>Reflex (Vasovagal):</strong> If reliable prodrome & not while driving: Can drive. No notification needed.</p>
                        <p><strong>Cough Syncope:</strong> G1: Stop 6 months. G2: Stop 12 months.</p>
                    </div>
                    <button class="btn-generate" onclick="openLetterModal('tloc')">üìÑ Discharge Letter</button>
                </div>

                <div class="card" data-condition="seizure">
                    <h4>Seizures</h4>
                    <h5>First Unprovoked, Provoked</h5>
                    <div class="card-body">
                        <p><strong>First Unprovoked:</strong> Stop driving for 12 months.</p>
                        <p><strong>Provoked (e.g., simple faint, concussive):</strong> Stop driving 6 months (G1) to 5 years (G2).</p>
                        <p><strong>Isolated Seizure:</strong> 6 months off (if no cause found) or 12 months (if cause found).</p>
                    </div>
                    <button class="btn-generate" onclick="openLetterModal('seizure')">üìÑ Discharge Letter</button>
                </div>

                <div class="card" data-condition="stroke">
                    <h4>Stroke & TIA</h4>
                    <h5>CVA, TIA</h5>
                    <div class="card-body">
                        <p><strong>TIA:</strong> Stop 1 month. No need to notify DVLA unless residual deficit.</p>
                        <p><strong>Stroke:</strong> Stop 1 month. May resume if recovery satisfactory. Notify DVLA if residual deficit persists.</p>
                    </div>
                    <button class="btn-generate" onclick="openLetterModal('stroke')">üìÑ Discharge Letter</button>
                </div>

                <div class="card" data-condition="headinjury">
                    <h4>Head Injury</h4>
                    <h5>Traumatic Brain Injury</h5>
                    <div class="card-body">
                        <p><strong>Minor:</strong> Resume on full clinical recovery if no seizure, PTA <24hrs, no bleed.</p>
                        <p><strong>Significant:</strong> Generally 6-12 months off driving. Notify DVLA.</p>
                    </div>
                    <button class="btn-generate" onclick="openLetterModal('headinjury')">üìÑ Discharge Letter</button>
                </div>
            </div>
        </section>

        <section id="cardiovascular" class="cat-cardio">
            <div class="section-header">
                <h3>ü´Ä Cardiovascular</h3>
                <a href="https://www.gov.uk/guidance/cardiovascular-disorders-assessing-fitness-to-drive" target="_blank" class="guidance-link">View Full Guidance ‚Üó</a>
            </div>
            <div class="grid">
                <div class="card" data-condition="acs">
                    <h4>Acute Coronary Syndrome</h4>
                    <h5>MI, MINOCA, Stent</h5>
                    <div class="card-body">
                        <p><strong>Group 1:</strong> Stop driving. Resume after 1 week (if successful PCI/stent) or 4 weeks (no PCI). No notification needed.</p>
                        <p><strong>Group 2:</strong> Stop driving. Notify DVLA. Relicense after 6 weeks pending tests.</p>
                    </div>
                    <button class="btn-generate" onclick="openLetterModal('acs')">üìÑ Discharge Letter</button>
                </div>

                <div class="card" data-condition="arrhythmia">
                    <h4>Arrhythmia / Pacemaker</h4>
                    <h5>SVT, AF, Heart Block</h5>
                    <div class="card-body">
                        <p><strong>Arrhythmia (incapacitating):</strong> Stop 4 weeks until controlled.</p>
                        <p><strong>Pacemaker Implant:</strong> Stop 1 week. Notify DVLA.</p>
                        <p><strong>ICD Implant:</strong> Stop 6 months. Notify DVLA. (Permanent bar for G2).</p>
                    </div>
                    <button class="btn-generate" onclick="openLetterModal('arrhythmia')">üìÑ Discharge Letter</button>
                </div>
            </div>
        </section>

        <section id="diabetes" class="cat-endocrine">
            <div class="section-header">
                <h3>ü©∏ Diabetes & Endo</h3>
                <a href="https://www.gov.uk/guidance/diabetes-mellitus-assessing-fitness-to-drive" target="_blank" class="guidance-link">View Full Guidance ‚Üó</a>
            </div>
            <div class="grid">
                <div class="card" data-condition="diabetes">
                    <h4>Diabetes (Insulin/Sulfonylureas)</h4>
                    <div class="card-body">
                        <p><strong>Group 1:</strong> Must notify DVLA if on Insulin. Must have awareness of hypos. No more than 1 severe hypo in 12 months.</p>
                        <p><strong>Severe Hypo:</strong> Stop driving, notify DVLA.</p>
                    </div>
                    <button class="btn-generate" onclick="openLetterModal('diabetes')">üìÑ Discharge Letter</button>
                </div>
            </div>
        </section>

        <section id="psychiatric" class="cat-psych">
            <div class="section-header">
                <h3>üß† Psychiatric</h3>
                <a href="https://www.gov.uk/guidance/psychiatric-disorders-assessing-fitness-to-drive" target="_blank" class="guidance-link">View Full Guidance ‚Üó</a>
            </div>
            <div class="grid">
                <div class="card" data-condition="psych">
                    <h4>Psychosis, Mania, Severe Depression</h4>
                    <div class="card-body">
                        <p><strong>Acute Episode:</strong> Must not drive during acute illness. Must notify DVLA.</p>
                        <p><strong>Resume:</strong> Usually after 3 months stability (Group 1).</p>
                    </div>
                    <button class="btn-generate" onclick="openLetterModal('psych')">üìÑ Discharge Letter</button>
                </div>
            </div>
        </section>

         <section id="drugs" class="cat-drugs">
            <div class="section-header">
                <h3>üíä Drugs & Alcohol</h3>
                <a href="https://www.gov.uk/guidance/drug-or-alcohol-misuse-or-dependence-assessing-fitness-to-drive" target="_blank" class="guidance-link">View Full Guidance ‚Üó</a>
            </div>
            <div class="grid">
                <div class="card" data-condition="substance">
                    <h4>Misuse & Dependence</h4>
                    <div class="card-body">
                        <p><strong>Alcohol Misuse:</strong> Stop driving, notify DVLA. Licence refused for min 6 months (G1).</p>
                        <p><strong>Drug Misuse:</strong> Stop driving, notify DVLA. 6-12 months abstinence required.</p>
                    </div>
                    <button class="btn-generate" onclick="openLetterModal('substance')">üìÑ Discharge Letter</button>
                </div>
            </div>
        </section>

        <footer>
            <p><strong>Disclaimer:</strong> This tool is an aide-memoire for clinicians. Always refer to official DVLA guidance (gov.uk) for definitive decisions. <br>
            Developed by WMEBEM (West Midlands Evidence Based Medicine Group). Code v2.0.</p>
        </footer>
    </main>

    <div class="modal-overlay" id="letterModal">
        <div class="modal">
            <div class="modal-header">
                <h3>Discharge Letter Generator</h3>
                <button class="close-modal" onclick="closeModal()">√ó</button>
            </div>
            
            <div id="letterContent" class="letter-preview">
                </div>

            <div class="modal-actions">
                <button class="btn btn-secondary" onclick="copyToClipboard()">üìã Copy Text</button>
                <button class="btn btn-secondary" onclick="printLetter()">üñ®Ô∏è Print</button>
                <button class="btn btn-primary" onclick="closeModal()">Done</button>
            </div>
        </div>
    </div>

    <script>
        // --- Navigation Scroll ---
        function scrollToSection(id) {
            document.getElementById(id).scrollIntoView({ behavior: 'smooth' });
        }

        // --- Search Functionality ---
        function filterContent() {
            const input = document.getElementById('searchInput');
            const filter = input.value.toLowerCase();
            const cards = document.querySelectorAll('.card');

            cards.forEach(card => {
                const text = card.textContent.toLowerCase();
                if (text.includes(filter)) {
                    card.style.display = "";
                } else {
                    card.style.display = "none";
                }
            });
        }

        // --- Letter Templates ---
        const templates = {
            tloc: {
                title: "Advice for Patients with Blackouts/Fainting (TLoC)",
                body: "Dear Patient,\n\nRE: Fitness to Drive following Transient Loss of Consciousness (Blackout)\n\nFollowing your assessment today for an episode of loss of consciousness, I must advise you on your legal obligations regarding driving.\n\nMEDICAL ADVICE:\nYou must NOT drive at this time.\n\nDVLA STANDARDS (GROUP 1 - Car/Motorcycle):\n- If this was a simple faint (vasovagal) with clear warning signs: You may drive, provided it did not happen while driving.\n- If this was an unexplained blackout: You must stop driving for 6 months and you MUST notify the DVLA.\n- If this was a cough-induced blackout: You must stop driving for 6 months.\n\nACTION REQUIRED:\n1. Do not drive until you meet the medical standards.\n2. Contact your insurance company to inform them of your medical condition.\n3. If required (see above), notify the DVLA using the forms available at https://www.gov.uk/health-conditions-and-driving.\n\nFailure to notify the DVLA is a criminal offence and may invalidate your insurance."
            },
            seizure: {
                title: "Advice for Patients with Seizure",
                body: "Dear Patient,\n\nRE: Fitness to Drive following a Seizure\n\nFollowing your assessment today, I must advise you that you are currently medically unfit to drive.\n\nDVLA STANDARDS (GROUP 1 - Car/Motorcycle):\n- First Unprovoked Seizure: You must stop driving for 12 months. You MUST notify the DVLA.\n- Provoked Seizure (e.g., due to illness/medication): You must stop driving for 6 months.\n\nACTION REQUIRED:\n1. Stop driving immediately.\n2. You must notify the DVLA. Please download form FEP1 from https://www.gov.uk/epilepsy-and-driving.\n3. Inform your insurance company.\n\nYour licence may be returned sooner if specific medical criteria are met, but you must await confirmation from the DVLA Medical Group."
            },
            stroke: {
                title: "Advice for Patients with Stroke/TIA",
                body: "Dear Patient,\n\nRE: Fitness to Drive following Stroke or TIA\n\nFollowing your diagnosis of a Stroke or TIA (Mini-stroke), you must stop driving immediately.\n\nDVLA STANDARDS:\n- TIA (Mini-Stroke): You must not drive for 1 month. You do not need to notify the DVLA unless you have ongoing problems with vision or limb movement after 1 month.\n- Stroke: You must not drive for 1 month. You may resume driving after 1 month if your doctor confirms you have made a satisfactory recovery. If you have residual weakness or visual loss after 1 month, you MUST notify the DVLA.\n\nACTION REQUIRED:\n1. Stop driving for at least 1 month.\n2. Check with your GP before resuming driving.\n3. Inform your insurance provider."
            },
            acs: {
                title: "Advice for Patients with Heart Attack / Angioplasty",
                body: "Dear Patient,\n\nRE: Fitness to Drive following Acute Coronary Syndrome (Heart Attack)\n\nFollowing your heart event, you must stop driving temporarily to allow for recovery.\n\nDVLA STANDARDS (GROUP 1):\n- If you have had an Angioplasty (stent): You may resume driving after 1 week if you are well.\n- If you did NOT have Angioplasty: You must not drive for 4 weeks.\n\nNote: You do not need to notify the DVLA unless you hold a Bus/Lorry (Group 2) licence, or if you have ongoing symptoms (angina) at rest or while driving.\n\nACTION REQUIRED:\n1. Stop driving for the period specified above.\n2. Inform your insurance company."
            },
            arrhythmia: {
                title: "Advice for Patients with Arrhythmia / Pacemaker",
                body: "Dear Patient,\n\nRE: Fitness to Drive following Heart Rhythm Disturbance\n\nDVLA STANDARDS:\n\n1. ARRHYTHMIA: If your heart rhythm problem caused you to be incapacitated, you must not drive for 4 weeks and until the condition is controlled.\n\n2. PACEMAKER: If you have had a pacemaker fitted, you must not drive for 1 week. You MUST notify the DVLA.\n\n3. ICD (Defibrillator): You must not drive for 6 months following implantation. You MUST notify the DVLA.\n\nACTION REQUIRED:\n1. Adhere to the non-driving period.\n2. Notify the DVLA if applicable (Form H1)."
            },
            headinjury: {
                title: "Advice for Patients with Head Injury",
                body: "Dear Patient,\n\nRE: Fitness to Drive following Head Injury\n\nDepending on the severity of your head injury, driving restrictions may apply.\n\nDVLA STANDARDS:\n- Minor Head Injury: If you have made a full clinical recovery, had no seizures, and scans showed no bleeding, you may resume driving when you feel safe to do so.\n- Significant Head Injury: If you had a brain haemorrhage or treatment for a brain injury, you must stop driving and notify the DVLA. You will likely be suspended from driving for 6 to 12 months.\n\nACTION REQUIRED:\n1. If in doubt, do not drive until you have seen your GP.\n2. If your injury was significant, notify the DVLA."
            },
            diabetes: {
                title: "Advice for Patients with Diabetes (Hypoglycaemia)",
                body: "Dear Patient,\n\nRE: Fitness to Drive - Diabetic Hypoglycaemia\n\nIf you have experienced a severe hypoglycaemic episode (needing assistance from another person), you must stop driving.\n\nDVLA STANDARDS:\n- Group 1 Drivers: You must not drive if you have had more than one episode of severe hypoglycaemia while awake in the last 12 months. You must notify the DVLA.\n- Awareness: If you have lost awareness of when your sugar is going low, you must stop driving and notify the DVLA.\n\nACTION REQUIRED:\n1. Ensure your blood sugars are stable before driving.\n2. Check your blood sugar 2 hours before driving and every 2 hours while driving.\n3. Always carry fast-acting carbohydrates in the car."
            },
            psych: {
                title: "Advice for Patients with Mental Health Conditions",
                body: "Dear Patient,\n\nRE: Fitness to Drive - Mental Health\n\nCertain mental health conditions require you to stop driving and notify the DVLA.\n\nDVLA STANDARDS:\n- You must not drive if your condition affects your concentration, agitation, or judgement.\n- Acute Psychosis / Mania: You must stop driving during the acute illness and notify the DVLA. Licensing is usually considered after 3 months of stability.\n\nACTION REQUIRED:\n1. Stop driving if you feel unwell or distracted.\n2. Notify the DVLA (Medical Questionnaire M1)."
            },
            substance: {
                title: "Advice for Patients regarding Alcohol/Drug Use",
                body: "Dear Patient,\n\nRE: Fitness to Drive - Alcohol or Drug Misuse\n\nDVLA STANDARDS:\n- Alcohol Misuse: If you have been diagnosed with alcohol misuse or dependence, you must stop driving and notify the DVLA. Your licence will be revoked for a minimum of 6 to 12 months.\n- Drug Misuse: Persistent misuse of illegal drugs requires you to stop driving and notify the DVLA. You will require a period of 6 to 12 months abstinence before re-licensing.\n\nACTION REQUIRED:\n1. Stop driving immediately.\n2. Notify the DVLA (Form DG1 or DR1).\n3. Driving while unfit through drink or drugs is a criminal offence."
            }
        };

        // --- Modal Logic ---
        const modal = document.getElementById('letterModal');
        const contentDiv = document.getElementById('letterContent');

        function openLetterModal(conditionKey) {
            const template = templates[conditionKey];
            if (!template) return;

            // Date formatting for the letter
            const date = new Date().toLocaleDateString('en-GB', { day: 'numeric', month: 'long', year: 'numeric' });
            
            // Construct the letter
            contentDiv.innerText = `Date: ${date}\n\n${template.body}`;
            
            modal.style.display = 'flex';
        }

        function closeModal() {
            modal.style.display = 'none';
        }

        // Close modal if clicking outside
        window.onclick = function(event) {
            if (event.target == modal) {
                closeModal();
            }
        }

        // --- Clipboard & Print ---
        function copyToClipboard() {
            const text = contentDiv.innerText;
            navigator.clipboard.writeText(text).then(() => {
                alert("Letter copied to clipboard!");
            });
        }

        function printLetter() {
            const printContent = contentDiv.innerText;
            const originalContent = document.body.innerHTML;
            
            // Simple print hack: replace body with text, print, restore
            // A better way is a print stylesheet, but for raw text this is effective for quick use
            const printWindow = window.open('', '', 'height=600,width=800');
            printWindow.document.write('<html><head><title>Discharge Letter</title>');
            printWindow.document.write('<style>body{font-family: sans-serif; white-space: pre-wrap; padding: 40px;}</style>');
            printWindow.document.write('</head><body>');
            printWindow.document.write(printContent);
            printWindow.document.write('</body></html>');
            printWindow.document.close();
            printWindow.print();
        }
    </script>
</body>
</html>
